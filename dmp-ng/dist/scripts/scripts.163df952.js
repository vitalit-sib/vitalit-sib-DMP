function splitDot(){return function(a){return a.replace(/\.\s+/g,".<br>")}}function formatMimeType(){return function(a){return a.replace("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Excel").replace("application/vnd.openxmlformats-officedocument.wordprocessingml.document","Word").replace("text/plain","txt").replace("application/vnd.openxmlformats-officedocument.spre","Excel").replace("application/vnd.oasis.opendocument.spreadsheet","OpenDocument Spreadsheet").replace("application/vnd.oasis.opendocument.presentation"," Open Document Format")}}function humanSamples(){return function(a){var b=[];return angular.forEach(a,function(a){a.name.toLowerCase().indexOf("human")>-1&&b.push(a)}),b}}function recommended(){return function(a){}}function noSubtitles(){return function(a){var b=[];return angular.forEach(a,function(a,c){null!=a.title&&b.push(a)}),b}}function sortObj(){return function(a){var b={};return Object.keys(a).sort().forEach(function(c){b[c]=a[c]}),b}}function formatNot(){return function(a){return"not_"!==a.substr(0,4).toLowerCase()?a:a.indexOf(" not ")>-1?a.substr(4).replace(" not "," "):a.indexOf("We have")>-1?a.substr(4).replace("We have","We don't have"):"No "+a.substr(4,1).toLowerCase()+a.substr(5)}}!function(){"use strict";angular.module("libs",[]).service("_",["$window",function(a){return a._}])}(),function(){"use strict";function a(a,b){a.when("/login",{templateUrl:function(){return"views/login.html"},controller:"LoginCtrl",controllerAs:"vm",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},pageKey:"HOME"}).when("/loginaai",{templateUrl:function(){return"views/login_switch.html"},controller:"LoginCtrl",controllerAs:"vm",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},pageKey:"HOME"}).when("/logout",{template:"",controller:"LoginCtrl",controllerAs:"vm",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},pageKey:"HOME"}).when("/login/user_id/:user_id/login/:login/code/:code/permissions/:permissions/institution/:institution",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"vm",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},pageKey:"HOME"}).when("/permissionDenied",{templateUrl:"views/permissiondenied.html",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},pageKey:"HOME"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl",controllerAs:"vm",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},pageKey:"HOME"}).when("/activation/:param",{templateUrl:"views/activation.html",controller:"RegisterCtrl",controllerAs:"vm",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},resolve:{Groups:["Restangular",function(a){return a.all("group").getList()}]},pageKey:"HOME"}).when("/reject/:param",{templateUrl:"views/activation.html",controller:"RegisterCtrl",controllerAs:"vm",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},resolve:{Groups:["Restangular",function(a){return a.all("group").getList()}]},pageKey:"HOME"}).when("/validationRequired",{templateUrl:"views/validationrequired.html",controller:"ValidationrequiredCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:[],permissionCheckType:"one"},resolve:{loggedUser:["User","Authentication",function(a,b){return a.GetByAuthdata(b.currentUser.authdata)}]},pageKey:"HOME"}).when("/forgetPassword",{templateUrl:"views/forgetpassword.html",controller:"ForgetpasswordCtrl",controllerAs:"vm",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},pageKey:"HOME"}).when("/setnewpassword",{templateUrl:"views/setnewpassword.html",controller:"SetnewpasswordCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["active"],permissionCheckType:"one"},pageKey:"HOME"}).when("/request/:action/:code",{templateUrl:"views/activation.html",controller:"RequestCtrl",controllerAs:"vm",access:{loginRequired:!1,permissions:[],permissionCheckType:"one"},resolve:{requestData:["Restangular","$route",function(a,b){var c=b.current.params.action,d=b.current.params.code;return a.one("request",c).one("code",d).get()}]},pageKey:"EXPERIMENTS"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["active","admin"],permissionCheckType:"all"},pageKey:"ADMIN"}).when("/users",{templateUrl:"views/userList.html",controller:"UserCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["admin","editor"],permissionCheckType:"one"},pageKey:"USERS"}).when("/user/:user_id",{templateUrl:"views/user.html",controller:"UserCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["active"],permissionCheckType:"one"},pageKey:"USERS"}).when("/groups",{templateUrl:"views/groups.html",controller:"GroupsCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["admin"],permissionCheckType:"one"},resolve:{groupList:["Restangular",function(a){return a.all("group").getList({members:"yes"})}]},pageKey:"USERS"}).when("/form",{templateUrl:"views/form.html",controller:"FormCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["active","admin"],permissionCheckType:"one"},pageKey:"CANVAS"}).when("/acknowledgements",{templateUrl:"views/acknowledgements.html",controller:"FormCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["active","admin"],permissionCheckType:"one"},pageKey:"ACKNOWLEDGEMENTS"}).when("/news",{templateUrl:"views/news.html",controller:"NewsCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["active"],permissionCheckType:"one"},pageKey:"NEWS"}).when("/news/:newsId",{templateUrl:"views/news/edit.html",controller:"NewsEditCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["admin","editor"],permissionCheckType:"one"},pageKey:"NEWS"}).when("/templates",{templateUrl:"views/templates.html",controller:"TemplatesCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["admin","editor"],permissionCheckType:"one"},pageKey:"TEMPLATES"}).when("/preview",{templateUrl:"views/templatespreview.html",controller:"TemplatesPreviewCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["admin","editor"],permissionCheckType:"one"},pageKey:"PREVIEW"}).when("/documentation",{templateUrl:"views/dbDocumentation.html",controller:"DocumentationCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["admin","editor"],permissionCheckType:"one"}}).when("/test",{templateUrl:"views/test.html",controller:"TestCtrl",controllerAs:"vm",access:{loginRequired:!0,permissions:["active"],permissionCheckType:"one"}}).when("/help",{templateUrl:"views/How_to_dmp_editor.html",access:{loginRequired:!0,permissions:["admin","editor"],permissionCheckType:"one"}}).otherwise({redirectTo:"/form"})}function b(a){a.decorator("$exceptionHandler",c)}function c(a,b,c){return function(b,d){a(b,d);c.error(b.message)}}function d(a){a.setPrefix("dmpApp").setStorageType("sessionStorage").setNotify(!0,!0)}function e(a,b){a.setBaseUrl(b.serverURL)}function f(a){a.hashPrefix("")}function g(a){angular.extend(a,{autoDismiss:!1,allowHtml:!0,containerId:"toast-container",maxOpened:5,closeButton:!0,closeHtml:"<button>&times;</button>",newestOnTop:!0,positionClass:"toast-top-right",preventDuplicates:!1,preventOpenDuplicates:!0,target:"body"})}function h(a,b,c,d,e,f){e.currentUser=c.get("currentUser")||{},void 0!==e.currentUser.username&&(d.defaults.headers.common.Authorization="Basic "+e.currentUser.authdata),a.$on("$routeChangeStart",function(a,c){var d;void 0!==c.access&&(d=f.authorize(c.access.loginRequired,c.access.permissions,c.access.permissionCheckType),d||(e.currentUser.username?b.path("/permissionDenied").replace():b.path("/login")))}),a.$on("$routeChangeSuccess",function(a,b){var c=b.pageKey;$(".pagekey").toggleClass("active",!1),$(".pagekey_"+c).toggleClass("active",!0)})}function i(a,b,c,d){b.setErrorInterceptor(function(b){return 401==b.status?(c.info("Login required... "),a.location.href="/login"):404==b.status?c.info("Resource not available..."):500==b.status?d.error(b.data):501==b.status?c.error(b.data,"ERROR"):c.warning("Response received with HTTP error code: "+b.status),!1})}angular.module("dmpApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","libs","toastr","restangular","config","LocalStorageModule","smart-table","ui.tinymce","angularFileUpload","ui.bootstrap","angular.filter","angular-clipboard","ui.select","ui.bootstrap","ui.checkbox","rzModule","btford.markdown"]).constant("siteTitle",{name:"DMP Canvas Generator"}).config(a).config(b).config(e).config(d).config(f).config(f).config(g).run(h).run(i),a.$inject=["$routeProvider","ENV"],b.$inject=["$provide"],c.$inject=["$delegate","$injector","$log"],d.$inject=["localStorageServiceProvider"],e.$inject=["RestangularProvider","ENV"],f.$inject=["$locationProvider"],g.$inject=["toastrConfig"],h.$inject=["$rootScope","$location","localStorageService","$http","Authentication","Authorization"],i.$inject=["$window","Restangular","toastr","$log"]}(),angular.module("config",[]).constant("ENV",{serverURL:"api/index.php/",withCredentials:!1,debugInfoEnabled:!1,CORS:!1}),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(){b.login(l.username,l.password).then(function(d){b.setCredentials(d.user_id,l.username,d.code,d.permissions,d.institution),"Y"==d.is_password_reset?a.path("/setnewpassword").replace():"R"==d.is_active?c.error("This account has been rejected.","Permission denied"):a.path("/")})}function k(){window.location.href="https://dmp.vital-it.ch/orcid/"}var l=this;l.login=j,l.siteTitle=d.name,l.local=g.CORS,l.isVitalIT=a.host().indexOf("vital-it")>-1||a.host().indexOf("localhost")>-1,l.openORCID=k,i(function(){"github"==h.version&&(l.gitHub=!0)});var m;!function(){m=b.currentUser.username,b.clearCredentials()}(),a.path().indexOf("logout")>-1&&(m.match(/\d{4}-\d{4}-\d{4}-\d{4}/)?e({method:"GET",url:"https://orcid.org/userStatus.json?logUserOut=true",headers:{Authorization:void 0}}).then(function(){a.path("/login")}):a.path("/login")),f.user_id&&(b.setCredentials(f.user_id,f.login,f.code,f.permissions.split(";"),f.institution),a.path("/"))}angular.module("dmpApp").controller("LoginCtrl",a),a.$inject=["$location","Authentication","toastr","siteTitle","$http","$routeParams","ENV","Git","$timeout"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(){k.dataLoading=!0,a.Create(k.user).then(function(a){console.log(a.permissions),console.log("ici2"),b.setCredentials(a.user_id,a.login,a.code,a.permissions,a.institution),c.path("/validationRequired")})}var k=this;k.siteTitle=i.name,k.register=j;var l=c.path().split("/")[1];if(b.clearCredentials(),"activation"==l||"reject"==l){var m=g.decode(f.param).split(":"),n=m[0],o=m[1],p=m[2],q=m[3];if(k.message={type:"info",text:""},p){var r=g.encode(p+":"+q);h.defaults.headers.common.Authorization="Basic "+r}a.GetById(n).then(function(b){n!==b.user_id||o!==b.activation_code||p!==b.leader.login?(k.message.type="error",k.message.text="Sorry, activation code is not valid"):"Y"==b.is_active?(k.message.type="warning",k.message.text="User "+b.firstname+" "+b.lastname+" is already active"):"activation"==l?(b.is_active="Y",a.Update(b).then(function(){k.message.type="success",k.message.text="The account for "+b.firstname+" "+b.lastname+" has been activated successfully"})):"reject"==l&&(b.is_active="R",a.Update(b).then(function(){k.message.type="warning",k.message.text="The account for "+b.firstname+" "+b.lastname+" has been rejected successfully. An email has been sent to "+b.email+"."}))})}}angular.module("dmpApp").controller("RegisterCtrl",a),a.$inject=["User","Authentication","$location","$rootScope","toastr","$routeParams","Base64","$http","siteTitle"]}(),function(){"use strict";function a(a,b,c){var d=this;d.user=b,"Y"==d.user.is_active&&c.path("/")}angular.module("dmpApp").controller("ValidationrequiredCtrl",a),a.$inject=["Authentication","loggedUser","$location"]}(),function(){"use strict";function a(a,b,c,d){function e(){f.email?a.resetPassword(f.email).then(function(a){b.success("An email has been sent to "+f.email+" with a temporary password.","Password reset successfully."),c.path("/login")}):b.error("Email is required","ERROR")}var f=this;f.siteTitle=d.name,f.resetPassword=e}angular.module("dmpApp").controller("ForgetpasswordCtrl",a),a.$inject=["User","toastr","$location","siteTitle"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){a.GetByAuthdata(b.currentUser.authdata).then(function(b){b.password=g.user.password,b.password2=g.user.password,a.Update(b).then(function(a){d.success("Password set successfully"),c.path("/")})})}var g=this;g.siteTitle=e.name,g.setPassword=f}angular.module("dmpApp").controller("SetnewpasswordCtrl",a),a.$inject=["User","Authentication","$location","toastr","siteTitle"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){i.user={username:"",firstname:"",lastname:"",project_id:null},a.currentUser.username&&b.GetByAuthdata(a.currentUser.authdata).then(function(a){i.user.username=a.login,i.user.firstname=a.firstname,i.user.lastname=a.lastname,i.user.user_id=a.user_id})}function h(a){}var i=this;i.projects=[],i.setProject=h,i.siteTitle=c.name,i.currentYear=(new Date).getFullYear(),g(),e.$watch(function(){return d.get("currentUser")},function(a,b){a!=b&&g()},!0)}angular.module("dmpApp").controller("NavCtrl",a),a.$inject=["Authentication","User","siteTitle","localStorageService","$scope","$filter"]}(),function(){"use strict";function a(a){var b=this;b.message=a}angular.module("dmpApp").controller("RequestCtrl",a),a.$inject=["requestData"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a){var b=g.findIndex(m.groups,function(b){return b.group_id==a});m.newGroup=m.groups[b],m.showNewGroup=!0,e.GetAll().then(function(a){m.users=a})}function i(a){c.one("group",a).remove().then(function(){d.success("Group removed successfuly","Success");var b=g.findIndex(m.groups,function(b){return b.group_id==a});b>-1&&m.groups.splice(b,1)})}function j(a,b){var c=g.findIndex(m.groups,function(b){return b.group_id==a});e.GetById(b).then(function(d){var f=g.findIndex(d.groups,function(b){return b.group_id==a});f>-1&&d.groups.splice(f,1),e.Update(d).then(function(){var a=g.findIndex(m.groups[c].members,function(a){return a.user_id==b});a>-1&&m.groups[c].members.splice(a,1)})})}function k(){m.showNewGroup?m.newGroup.group_id?m.newGroup.put().then(function(){m.showNewGroup=!1,d.success("Group modified successfully","Success")}):m.groups.post(m.newGroup).then(function(a){c.one("group",a).get({members:"yes"}).then(function(a){a&&m.groups.push(a)}),m.showNewGroup=!1,d.success("Group created successfully","Success")}):(m.showNewGroup=!0,m.newGroup={group_id:null,name:"",institution:"",leader_id:"",members:[{user_id:f.currentUser.user_id}],projects:[{project_id:f.currentUser.project_id}]},e.GetAll().then(function(a){m.users=a}))}function l(a,b){var c=m["project"+b.project_id+"group"+a.group_id];if(c)a.projects.push(b);else{var e=g.findIndex(a.projects,function(a){return a.project_id==b.project_id});e>-1?a.projects.splice(e,1):console.error("project not found")}a.put().then(function(){d.success("Project "+(c?"added":"removed")+" successfuly","success")})}var m=this;m.groups=b,m.displayedCollection=[].concat(m.groups),m.editGroup=h,m.deleteGroup=i,m.removeMember=j,m.createGroup=k,m.toggleProject=l,m.showNewGroup=!1}angular.module("dmpApp").controller("GroupsCtrl",a),a.$inject=["siteTitle","groupList","Restangular","toastr","User","Authentication","_"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){var l=this;l.data=null,l.template=null,l.iso=null,l.cc=null,l.is_recommended="<span class='label label-warning'><i>recommended</i></span>",l.slider={minValue:100,maxValue:1e3,options:{floor:1,ceil:1e5,logScale:!0,disabled:!1,translate:function(a){var b;return 1e3>a?b=a>100?10*Math.round(a/10)+" GB":a+" GB":Math.round(a/1e3)+" TB"}}},l.refreshSlider=function(){c(function(){a.$broadcast("rzSliderForceRender")})};var m=e.one("form").get();m.then(function(a){l.data=a,l.data.name="",l.data.description="",l.data.datatypes.other.array=[{index:0,value:""}],l.data.analysis.other.array=[{index:0,value:""}],l.data.internal_existing_data.other.array=[{index:0,value:""}],l.data.external_existing_data.other.array=[{index:0,value:""}],angular.forEach(l.data.security_standards.params,function(a){1==a.is_selected&&(l.iso=a)}),angular.forEach(l.data.licenses.params,function(a){1==a.is_selected&&(l.cc=a)})}),l.changeActive=function(a,b,c){"meta"===c?angular.forEach(l.data.datatypes.params,function(c){c.name===a&&angular.forEach(c.metadata,function(a){b.name===a.name?a.is_selected=!0:a.is_selected=!1})}):"storage"===c?"other"==b?(angular.forEach(l.data.storage.params,function(a){a.is_selected=!1}),l.data.storage.other.is_selected=!0):(angular.forEach(l.data.storage.params,function(a){b.name===a.name?a.is_selected=!0:a.is_selected=!1}),l.data.storage.other.is_selected=!1):"repo"===c?angular.forEach(l.data.datatypes.params,function(c){c.name===a&&angular.forEach(c.repositories,function(a){b.name===a.name?a.is_selected=!0:a.is_selected=!1})}):"iso"===c?angular.forEach(l.data.security_standards.params,function(a){b.name===a.name?a.is_selected=!0:a.is_selected=!1}):"cc"===c?angular.forEach(l.data.licenses.params,function(a){b.name===a.name?a.is_selected=!0:a.is_selected=!1}):"anon"===c?angular.forEach(l.data.anonymizations.params,function(a){b.name===a.name?a.is_selected=!0:a.is_selected=!1}):"humEthic"===c?angular.forEach(l.data.committee_human.params,function(a){b.name===a.name?a.is_selected=!0:a.is_selected=!1}):"vertEthic"===c&&angular.forEach(l.data.committee_vertebrate.params,function(a){b.name===a.name?a.is_selected=!0:a.is_selected=!1})},l.sliderValToString=function(a){var b;return b=1e3>a?a>100?10*Math.round(a/10)+" GB":a+" GB":Math.round(a/1e3)+" TB"},l.addOtherField=function(a){var b=a.array.length;a.array.push({index:b,value:""})},l.rmOtherField=function(a,b){a.array.splice(b.index,1),angular.forEach(a.array,function(a,b){a.index=b})},l.formatOtherVal=function(a){var b="";angular.forEach(a.array,function(a,c){0==c&&a.value.length&&(b=a.value),c>0&&a.value.length&&(b=b+","+a.value)}),a.value=b},l.downloadform=function(){angular.forEach(l.data.data.params,function(a){"125"==a.parameter_id?a.value=l.sliderValToString(l.slider.minValue):"126"==a.parameter_id?a.value=l.sliderValToString(l.slider.maxValue):"124"==a.parameter_id&&(a.is_selected=l.slider.options.disabled)}),l.formatOtherVal(l.data.datatypes.other),l.formatOtherVal(l.data.analysis.other),l.formatOtherVal(l.data.internal_existing_data.other),l.formatOtherVal(l.data.external_existing_data.other),l.data.put().then(function(a){self.location.href=k.serverURL+"/download/"+h.currentUser.user_id+"/code/"+a})},l.loadOldTemplate=function(){l.template&&e.one("template",l.template.dmp_id).get().then(function(a){var b=angular.fromJson(a.dmp_info);angular.forEach(b,function(a,b){angular.forEach(l.data,function(c,d){d==b&&"previousTemplate"!=b&&(l.data[d]=a)})}),l.data.name=l.template.dmp_name})},l.removeTemplate=function(){e.one("template",l.template.dmp_id).remove().then(function(){angular.forEach(l.data.previousTemplate,function(a,b){a.dmp_id==l.template.dmp_id&&(l.data.previousTemplate.splice(b,1),l.template=!1,l.data.name="",l.data.description="")})})}}angular.module("dmpApp").controller("FormCtrl",a),a.$inject=["$scope","$route","$timeout","siteTitle","Restangular","toastr","User","Authentication","_","$location","ENV"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k){function l(b){a.GetById(b).then(function(a){q.user=a,null==q.user.newsletter&&(q.user.newsletter="N"),+s.user_id===+b||-1!==s.permissions.indexOf("admin")||leader||(f.error("Sorry, you cannot edit this account.","Permission denied"),h.path("/users"))})}function m(){q.getters={user:function(a){return a.lastname+a.firstname}},q.displayedCollection=[].concat(q.users),a.GetAll().then(function(a){if(q.users=a,void 0!==q.users||0!=q.users.length){var b=q.users[0].institution;q.institution=b.split(".ch")[0]}})}function n(b){console.log(b),1==b.is_editor&&(b.is_editor="Y"),0==b.is_editor&&(b.is_editor="N"),a.Update(b)}function o(a){if(r){var b=q.user.permissions,c=b.indexOf("group_"+a.group_id);if(-1===c)q.user.permissions.push("group_"+a.group_id),q.user.groups.push(a);else{q.user.permissions.splice(c,1);var d=i.findIndex(q.user.groups,function(b){return b.group_id==a.group_id});d>-1&&q.user.groups.splice(d,1)}}}function p(){a.Update(q.user).then(function(a){q.user=a,f.success("Account updated successfully","Success")})}var q=this;q.getUser=l,q.listUsers=m,q.changeEditorStatus=n,q.toggleGroup=o,q.updateUser=p,q.users=[],q.siteTitle=c.name;var r=e.user_id,s=d.getCredentials();r?l(r):m()}angular.module("dmpApp").controller("UserCtrl",a),a.$inject=["User","Group","siteTitle","Authentication","$routeParams","toastr","$filter","$location","_","Restangular","$timeout"]}(),function(){"use strict";function a(a,b,c,d){function e(){a.path("/news/new")}var f=this;f.newsIsActive="Y",f.siteTitle=d.name,f.initNews=e,function(){b.all("news").getList().then(function(a){f.news=a})}()}angular.module("dmpApp").controller("NewsCtrl",a),a.$inject=["$location","Restangular","Authentication","siteTitle"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(){i.info.project_id="Y"==i.info.restricted?e.currentUser.project_id:null,delete i.info.restricted,-1==i.info.news_id?(delete i.info.news_id,b.news.post(i.info).then(function(){c.success("News created successfuly","success"),d.path("/news")})):i.info.save().then(function(){c.success("News updated successfuly","success"),d.path("/news")})}function h(){i.info.confirmDelete?f.one("news",i.info.news_id).remove().then(function(){c.success("News deleted successfuly","success"),d.path("/news")}):i.info.confirmDelete=!0}var i=this;i.currentProjectId=e.currentUser.project_id,i.submitNews=g,i.deleteNews=h,i.minDate=new Date,i.status={opened:!1},i.open=function(a){i.status.opened=!0};var j=a.newsId;"new"==j?i.info={news_id:-1,title:"",content:"",is_active:"Y",restricted:"N"}:b.getOne(j).then(function(a){i.info=a,i.info.restricted=a.project_id?"Y":"N"})}angular.module("dmpApp").controller("NewsEditCtrl",a),a.$inject=["$routeParams","News","toastr","$location","Authentication","Restangular"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){var a=m.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/modal/How_to_dmp_editor.html",size:"lg",controller:function(){var b=this;b.close=function(){a.close()}},controllerAs:"$ctrl"});a.result.then(function(){},function(){})}function p(a,b){B.section=a,B.showTextBox=!0,B.section_button=null!=b?a+" "+b:a}function q(a,b){B.templates[b.section_number].selected=a,B.parameter_button=a,B.showTextBox=!0}function r(){C.post(B.templates).then(function(a){a===!0&&f.success("Your template has been updated")})}function s(a){B.type=a,B.parameter_type_button=a}function t(a,b){a.recommendation_id=b}function u(){B.recommendationData[0].recommendation=B.recommendation.recommendation,B.recommendationData[0].parameter_types=B.recommendation.parameter_types,B.recommendationData.post()}function v(){B.aboutContactData[0].about=B.aboutContact.about,B.aboutContactData[0].contact=B.aboutContact.contact,B.aboutContactData.post()}function w(a,b){var c,d,e,f;return"heading"==b?(c=a.heading_user,d=a.heading,e=a.heading_institution,a.changeToHeader||(a.changeToHeader=null==e?B.institution:"DMP"),f=a.changeToHeader):"text"==b?(c=a.text_user,d=a.text,e=a.text_institution,a.changeToText||(a.changeToText=null==e?B.institution:"DMP"),f=a.changeToText):"footer"==b&&(c=a.footer_user,d=a.footer,e=a.footer_institution,a.changeToFooter||(a.changeToFooter=null==e?B.institution:"DMP"),f=a.changeToFooter),a.isReset=!1,c!=d&&null==e&&(a.isReset=!0),c!=e&&null==d&&(a.isReset=!0),null!=e&&null!=d&&("DMP"==f&&c!=e&&(a.isReset=!1),f==B.institution&&c!=d&&(a.isReset=!0)),a.isReset}function x(a,b){"heading"==b?(a.heading_user=a.changeToHeader==B.institution?a.heading_institution:a.heading,a.changeToHeader=a.changeToHeader==B.institution?"DMP":B.institution):"text"==b?(a.text_user=a.changeToText==B.institution?a.text_institution:a.text,a.changeToText=a.changeToText==B.institution?"DMP":B.institution):"footer"==b&&(a.footer_user=a.changeToFooter==B.institution?a.footer_institution:a.footer,a.changeToFooter=a.changeToFooter==B.institution?"DMP":B.institution)}function y(a,b){"heading"==b?a.heading_user=a.changeToHeader==B.institution?a.heading:a.heading_institution:"text"==b?a.text_user=a.changeToText==B.institution?a.text:a.text_institution:"footer"==b&&(a.footer_user=a.changeToFooter==B.institution?a.footer:a.footer_institution)}function z(){B.templates_preview=angular.copy(B.templates),angular.forEach(B.templates_preview,function(a){angular.forEach(a.templates,function(a){a.text=a.text.replace(/(\[[^\]]+\])/,'<span style ="color:red">$1</span>')}),a.footer&&(a.footer=a.footer.replace(/(\[[^\]]+\])/,'<span style ="color:red">$1</span>')),a.heading&&(a.heading=a.heading.replace(/(\[[^\]]+\])/,'<span style ="color:red">$1</span>'))})}function A(a){return k.trustAsHtml(a)}var B=this;d.currentUser.institution&&(B.institution=d.currentUser.institution.split(".")[0]),B.select_section=p,B.select_parameter=q,B.saveTemplates=r,B.select_parameter_type=s,B.changeRecommendation=t,B.saveRecommendation=u,B.previewFormatting=z,B.openHelp=o,B.trustAsHtml=A,B.isResetChanges=w,B.resetChanges=y,B.toggleTemplate=x,B.saveAboutContact=v,B.section_button="Choose a section to modify",B.parameter_type_button="Choose a recommendation category",B.editText=!1,B.showPreview=!1,B.negation="",B.alertOK=!1;var C=j.all("/templateSpecific"),D=j.all("recommendation"),E=j.all("aboutContact");E.getList().then(function(a){B.aboutContactData=a,B.aboutContact=a.plain()[0]}),D.getList().then(function(a){B.recommendationData=a,B.recommendation=a.plain()[0],angular.forEach(B.recommendation.parameter_types,function(a){angular.forEach(a,function(a){null==a.recommendation_id&&(a.recommendation="displayed")})}),angular.forEach(B.recommendation.recommendation,function(a){"not displayed"==a.recommendation&&(a.recommendation="displayed",B.recommendation_id=a.recommendation_id)})}),l.GetTemplates().then(function(a){B.templates=a.plain(),B.footer={},angular.forEach(B.templates,function(a,b){a.selected=Object.keys(B.templates[b].templates)[0]}),z()})}function b(a){var b=this;b.salut="poilu",b.close=function(){a.dismiss("close")}}angular.module("dmpApp").controller("TemplatesCtrl",a).controller("helpModalController",b),a.$inject=["User","Group","siteTitle","Authentication","$routeParams","toastr","$filter","$location","_","Restangular","$sce","Templates","$uibModal","$scope"],b.$inject=["$uibModalInstance"]}(),function(){"use strict";function a(a,b){var c=this,d=b.all("paramKeyNames");d.getList().then(function(a){c.key_names=a.join(", ")})}angular.module("dmpApp").controller("DocumentationCtrl",a),a.$inject=["$scope","Restangular"]}(),function(){"use strict";function a(a,b){var c=this,d=b.one("form").get();d.then(function(a){console.log(a.about),c.data=a})}angular.module("dmpApp").controller("TestCtrl",a),a.$inject=["$scope","Restangular"]}(),function(){"use strict";function a(a,b){return{restrict:"A",scope:{},link:function(c,d,e){var f=function(){d.removeClass("hidden")},g=function(){d.addClass("hidden")},h=function(b){var c;b&&f(),c=a.authorize(!0,j,e.accessPermissionType),c?f():g()},i=function(){j.length>0&&h(!0)},j=e.access.split(",");i(),c.$watch(function(){return b.get("currentUser")},function(a,b){a!=b&&i()},!0)}}}a.$inject=["Authorization","localStorageService"],angular.module("dmpApp").directive("access",a),a.$digest=["Authorization","localStorageService"]}(),function(){"use strict";function a(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,b,c,d){d.$validators.compareTo=function(b){return b==a.otherModelValue},a.$watch("otherModelValue",function(){d.$validate()})}}}function b(){return{require:"ngModel",link:function(a,b,c,d){function e(a){return a.length>=8?d.$setValidity("length",!0):d.$setValidity("length",!1),a.match(/\d/)?d.$setValidity("numeric",!0):d.$setValidity("numeric",!1),a.match(/[a-z]/)?d.$setValidity("lowercase",!0):d.$setValidity("lowercase",!1),a.match(/[A-Z]/)?d.$setValidity("uppercase",!0):d.$setValidity("uppercase",!1),a}d.$parsers.push(e)}}}function c(){return{restrict:"E",scope:{},link:function(a,b,c){if(c.icon){var d=document.createElement("i");d.className="fa fa-envelope",d.style.marginRight="8px",b[0].appendChild(d)}var e=document.createElement("a");if(e.href="mailto:"+c.name+"@"+c.domain,c.title&&(e.href+="?subject="+c.title),b[0].appendChild(e),c.content)e.innerHTML=c.content;else{var f=document.createElement("span");f.innerHTML=c.name;var g=document.createElement("i");g.className="fa fa-at";var h=document.createElement("span");h.innerHTML="@",h.className="sr-only";var i=document.createElement("span");i.innerHTML=c.domain,e.appendChild(f),e.appendChild(g),e.appendChild(h),e.appendChild(i)}c.nav&&(e.className="navLink")}}}angular.module("dmpApp").directive("compareTo",a).directive("checkPassword",b).directive("emailObf",c),c.$inject=[]}(),angular.module("dmpApp").filter("splitDot",splitDot).filter("formatMimeType",formatMimeType).filter("humanSamples",humanSamples).filter("recommended",recommended).filter("noSubtitles",noSubtitles).filter("sortObj",sortObj).filter("formatNot",formatNot),function(){"use strict";function a(a){return function(a){if(!angular.isArray(a))return a;for(var b=[],c=0;c<a.length;c++)"group_"===a[c].substr(0,6)&&b.push({group_id:a[c].substr(6)});return b}}angular.module("dmpApp").filter("getGroupFromPermission",a),a.$inject=["Group"]}(),function(){"use strict";function a(a){function b(){return l.getList().then(i,j("Error getting all users"))}function c(a){return l.get(a).then(i,j("Error getting user by id"))}function d(b){return a.one("user",b).get().then(i,j("Error getting user by username"))}function e(b){return a.all("resetpass").post({email:b})}function f(a){return l.post(a).then(i,j("Error creating user"))}function g(a){return a.put().then(i,j("Error updating user"))}function h(a){return l.get(a).remove().then(i,j("Error deleting user"))}function i(a){return a}function j(a){return function(){return{success:!1,message:a}}}var k={},l=a.all("user");return k.GetAll=b,k.GetById=c,k.GetByAuthdata=d,k.Create=f,k.Update=g,k.Delete=h,k.resetPassword=e,k}angular.module("dmpApp").factory("User",a),a.$inject=["Restangular"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(a,b){return f.all("authenticate").post({username:a,password:b})}function k(c,d,e,f,h){var i=g.encode(f.join(";"));a.defaults.headers.common.Authorization="Basic "+e,n.currentUser={user_id:c,username:d,authdata:e,permissions:i,institution:h},b.set("currentUser",n.currentUser)}function l(){n.currentUser={},b.remove("currentUser"),a.defaults.headers.common.Authorization="Basic"}function m(){var a=angular.copy(n.currentUser);if(void 0!==n.currentUser.permissions){var b=g.decode(n.currentUser.permissions);a.permissions=b.split(";")}return a}var n={currentUser:{}};return n.login=j,n.setCredentials=k,n.clearCredentials=l,n.getCredentials=m,n}angular.module("dmpApp").factory("Authentication",a),a.$inject=["$http","localStorageService","$rootScope","$timeout","User","Restangular","Base64","toastr","$route"]}(),function(){"use strict";function a(a){function b(b,c,d){var e,f,g=!0,h=a.getCredentials(),i=[],j=!0;if(d=d||"one",b===!0&&void 0===h.username)g=!1;else if(b!==!0||void 0===h.username||void 0!==c&&0!==c.length){if(c){for(i=[],angular.forEach(h.permissions,function(a){i.push(a.toLowerCase())}),f=0;f<c.length;f+=1){e=c[f].toLowerCase();var k="!"===e.substr(0,1);if(k&&(e=e.substr(1)),"all"===d){if(j=k?j&&-1===i.indexOf(e):j&&i.indexOf(e)>-1,j===!1)break}else if("one"===d&&(j=k?-1===i.indexOf(e):i.indexOf(e)>-1))break;
}g=j}}else g=!0;return g}var c={};return c.authorize=b,c}angular.module("dmpApp").factory("Authorization",a),a.$inject=["Authentication"]}(),function(){"use strict";function a(a){function b(){return d.getList().then(function(a){c.groups=[].concat(a)})}var c={};c.groups=[];var d=a.all("group");return c.getAll=b,c}angular.module("dmpApp").factory("Group",a),a.$inject=["Restangular"]}(),function(){"use strict";function a(){function a(a){var b,c,d,e,f,g="",h="",i="",j=0;do b=a.charCodeAt(j++),c=a.charCodeAt(j++),h=a.charCodeAt(j++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|h>>6,i=63&h,isNaN(c)?f=i=64:isNaN(h)&&(i=64),g=g+this.keyStr.charAt(d)+this.keyStr.charAt(e)+this.keyStr.charAt(f)+this.keyStr.charAt(i),b=c=h="",d=e=f=i="";while(j<a.length);return g}function b(a){var b,c,d,e,f,g="",h="",i="",j=0,k=/[^A-Za-z0-9\+\/\=]/g;k.exec(a)&&console.error("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do d=this.keyStr.indexOf(a.charAt(j++)),e=this.keyStr.indexOf(a.charAt(j++)),f=this.keyStr.indexOf(a.charAt(j++)),i=this.keyStr.indexOf(a.charAt(j++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,h=(3&f)<<6|i,g+=String.fromCharCode(b),64!=f&&(g+=String.fromCharCode(c)),64!=i&&(g+=String.fromCharCode(h)),b=c=h="",d=e=f=i="";while(j<a.length);return g}var c={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:a,decode:b};return c}angular.module("dmpApp").factory("Base64",a)}(),function(){"use strict";function a(a,b){function c(b){return a.one("news",b).get()}var d={};return d.news=a.one("project",b.currentUser.project_id).all("news"),d.getOne=c,d}angular.module("dmpApp").factory("News",a),a.$inject=["Restangular","Authentication"]}(),function(){"use strict";function a(a){function b(b){return a.one("dataset",b).get()}var c={};return c.dataset=a.all("dataset"),c.getOne=b,c}angular.module("dmpApp").factory("Experiments",a),a.$inject=["Restangular"]}(),function(){"use strict";function a(a,b){var c={};return c.git=a.all("git"),c.git.getList().then(function(a){c.version=a.plain()[0]}),c}angular.module("dmpApp").factory("Git",a),a.$inject=["Restangular"]}(),function(){"use strict";function a(a){function b(b){return a.one("templates").get().then(c,d("Error getting user by templates"))}function c(a){return a}function d(a){return function(){return{success:!1,message:a}}}var e={};return e.GetTemplates=b,e}angular.module("dmpApp").factory("Templates",a),a.$inject=["Restangular"]}();